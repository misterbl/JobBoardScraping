require 'nokogiri'

require "open-uri"


job_list = "job_list.txt"
write_jobs = File.open(job_list, "a")
job_list = []

task :scrap_jobs, [:arg] do |t, args|
  url = "https://jobonline.thecareersgroup.co.uk/careersgroup/student/Vacancies.aspx?st=#{args[:arg].to_str}"
  page = Nokogiri::HTML(open(url))
  vacancies = page.xpath('//div[starts-with(@id, "ctl00_ContentPlaceHolder1_SearchVacancies1_VacancySummaryUC1_lvVacancies_ctr")]')
  vacancies.each do |vacancy|
    write_jobs.puts [vacancy.css("span.v2_title").text, vacancy.xpath('//span[contains(@id, "DatePosted")]').text, vacancy.at('//span[contains(@id, "Salary")]').text]
  end

end



# task :scrap_jobs, [:arg] do |t, args|
#   url = "https://jobonline.thecareersgroup.co.uk/careersgroup/student/Vacancies.aspx?st=#{args[:arg].to_str}"
#   page = Nokogiri::HTML(open(url))
#   vacancies = page.xpath('//div[starts-with(@id, "ctl00_ContentPlaceHolder1_SearchVacancies1_VacancySummaryUC1_lvVacancies_ctr")]')
#
#   vacancies.each_with_index do |vacancy, index|
#     i = index + 1
#     p vacancy.css("span#ctl00_ContentPlaceHolder1_SearchVacancies1_VacancySummaryUC1_lvVacancies_ctrl#{i}_lblDatePosted")
#     p i
#     # puts vacancy.css("span.v2_title").text
#     # write_jobs.puts [vacancy.css("span.v2_title").text,
#     #   vacancy.css("span#ctl00_ContentPlaceHolder1_SearchVacancies1_VacancySummaryUC#{i}_lvVacancies_ctrl7_lblDatePosted").text]
#       # vacancy.at('//span[contains(@id, "Salary")]').text]
#   end
#
# end
